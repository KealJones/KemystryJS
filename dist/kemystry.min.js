/*!
 * Kemystry.js - v0.1.0
 *
 * Copyright (c) 2019 Keal Jones @ We Are Kemy <http://wearekemy.com>
 * Released under the MIT license
 *
 * Date: 2019-10-10
 */

!function(root,factory){"use strict";"object"==typeof module&&"object"==typeof module.exports?module.exports=root.document?factory(root,!0):function(w){if(!w.document)throw new Error("Kemystry-WD");return factory(w)}:factory(root)}("undefined"!=typeof window?window:this,function(window,noGlobal){var Kemystry=function(Kemystry){var KEMYSTRY_DATATAG_NAME="data-kemy";function Pipette(kemycalSymbol){if(Lab.Workspace.Beakers.hasOwnProperty(kemycalSymbol)){var kemycalSource=Lab.Workspace.Beakers[kemycalSymbol];if(null===kemycalSource||"object"!=typeof kemycalSource)return;return new Kemycal(function takeProperties(obj){var copy;if(null===obj||"object"!=typeof obj)return obj;if(obj instanceof Array){copy=[];for(var i=0,len=obj.length;i<len;i++)copy[i]=takeProperties(obj[i]);return copy}if(obj instanceof Object){for(var attr in copy={},obj)obj.hasOwnProperty(attr)&&(copy[attr]=takeProperties(obj[attr]));return copy}throw new Error("Unable to copy obj! Its type isn't supported.")}(kemycalSource))}return!1}function Tube(el){for(var kemycal in this.element=el,this.mixture=new KemycalMixture(this.element.getAttribute(KEMYSTRY_DATATAG_NAME)),this.mixture.Kemycals){this.mixture.Kemycals[kemycal].tube=this}}function TubeRack(els){var TubeElements=[];for(var el in els)els.hasOwnProperty(el)&&(els[el]instanceof Tube?TubeElements.push(els[el]):TubeElements.push(new Tube(els[el])));this.Rack=TubeElements}function Kemycal(kemycalProperties){return this._labId=Lab.Tools.Labeler(),this.intensive={symbol:""},this.extensive={},this.procedures={},kemycalProperties.hasOwnProperty("intensive")&&(this.intensive=kemycalProperties.intensive),kemycalProperties.hasOwnProperty("react_on")&&(this.intensive.react_on=kemycalProperties.react_on),kemycalProperties.hasOwnProperty("extensive")&&(this.extensive=kemycalProperties.extensive),kemycalProperties.hasOwnProperty("procedures")&&(this.procedures=kemycalProperties.procedures),kemycalProperties.hasOwnProperty("symbol")&&(this.intensive.symbol=kemycalProperties.symbol.toLowerCase()),this}function KemycalMixture(kemycalFormula){if(kemycalFormula instanceof Array){var tempMixedKemycalsArray=[];for(var kemycal in kemycalFormula)tempMixedKemycalsArray.push(kemycalFormula[kemycal]);this.Kemycals=tempMixedKemycalsArray}else{var tempMixedKemycalsObject={},derivedFormula=Lab.Tools.Deriver.derive(kemycalFormula);for(var kemycalSymbol in derivedFormula){var pipette=Pipette(kemycalSymbol);!1!==pipette&&(tempMixedKemycalsObject[kemycalSymbol]=pipette,tempMixedKemycalsObject[kemycalSymbol].state(derivedFormula[kemycalSymbol]))}this.Kemycals=tempMixedKemycalsObject}return this}Kemystry={open:function(){},setup:function(){for(var symbol in Lab.Workspace.Beakers)Lab.Workspace.Beakers[symbol].prep();var allTubes=Lab.Tools.Collector.Tubes.all();Lab.Tools.Styler.setup(),allTubes.each(function(tube){tube.getMixture().each(function(kemycal){if(kemycal.act(),kemycal.intensive.hasOwnProperty("react_on"))for(var event in kemycal.intensive.react_on){var eventName=kemycal.intensive.react_on[event];!function(tube,kemycal,event){kemycal.tube.examine(event,function(){kemycal.react(event)})}(kemycal.tube,kemycal,eventName)}})})},beaker:function(kemycalProperties){return function(kemycalProperties){{if("object"==typeof kemycalProperties){Lab.Workspace.Beakers[kemycalProperties.symbol.toLowerCase()]=new Kemycal(kemycalProperties);return this}if(kemycalProperties&&Lab.Workspace.Beakers.hasOwnProperty(kemycalProperties.toLowerCase()))return{prep:function(extProps){return Lab.Workspace.Beakers[kemycalProperties.toLowerCase()].prep(extProps),this}}}}(kemycalProperties)}},Tube.prototype={getMixture:function(){return this.mixture},updateFormula:function(){return this.element.setAttribute(KEMYSTRY_DATATAG_NAME,Lab.Tools.Deriver.underive(this.mixture.Kemycals)),this},content:function(contentValue){return contentValue?(this.element.innerHTML=contentValue,this):this.element.innerHTML},sell:function(){return"undefined"!=typeof $?$(this.element):"undefined"!=typeof jQuery?jQuery(this.element):void 0!==window.jQuery?window.jQuery(this.element):null},examine:function(event,callback){document.addEventListener?this.element.addEventListener(event,callback,!1):document.attachEvent?this.element.attachEvent("on"+event,callback):this.element["on"+event]=callback},unexamine:function(event,callback){document.removeEventListener?this.element.removeEventListener(event,callback,!1):document.detachEvent?this.element.detachEvent("on"+event,callback):this.element["on"+event]=null}},TubeRack.prototype={each:function(proc){for(var tube in this.Rack)proc(this.Rack[tube])},get:function(offset){return this.Rack[offset]},byKemycal:function(symbol){var tubesByKemycal=[];for(var tube in this.Rack){this.Rack[tube].getMixture().Kemycals.hasOwnProperty(kemycalSymbol)&&tubesByKemycal.push(this.Rack[tube])}return new TubeRack(tubesByKemycal)},size:function(){return Object.keys(this.Rack).length}},Kemycal.prototype={prep:function(userExtensive){return mergeExtensive=function(destination,source){for(var property in source)source[property]&&source[property].constructor&&source[property].constructor===Object?(destination[property]=destination[property]||{},arguments.callee(destination[property],source[property])):destination[property]=source[property];return destination},this.intensive.hasOwnProperty("user_extensive")&&!1===this.intensive.user_extensive||mergeExtensive(this.extensive,userExtensive),this.hasOwnProperty("procedures")&&this.procedures.hasOwnProperty("prep")&&this.procedures.prep.apply(this,arguments),this},act:function(){return this.hasOwnProperty("procedures")&&this.procedures.hasOwnProperty("act")&&this.procedures.act.apply(this,arguments),this},react:function(){return this.hasOwnProperty("procedures")&&this.procedures.hasOwnProperty("react")&&this.procedures.react.apply(this,arguments),this},symbol:function(){return this.intensive.symbol},state:function(kemycalState){return kemycalState?(this.intensive.state=kemycalState,this.hasOwnProperty("tube")&&this.tube.updateFormula(),this):this.intensive.state},ext:function(propKey,propValue){if(propKey){if("object"!=typeof propKey)return propValue?Lab.Tools.Holder(this.extensive).getByDot(propKey,propValue):Lab.Tools.Holder(this.extensive).getByDot(propKey);for(var propertyName in propKey)this.ext(propertyName,propKey[propertyName]);return this.extensive}return this.extensive},phys:function(style,state){return void 0===state&&(state=Lab.Tools.Deriver.underiveState(this.state())),state instanceof Array&&(state=Lab.Tools.Deriver.underiveState(state)),Lab.Tools.Styler.add(this.symbol(),state,style),Lab.Tools.Styler.update(),this},content:function(content){return this.tube.content(content),this},tube:function(){return this.tube},getAll:function(){return Lab.Tools.Collector.Tubes.all(),Lab.Tools.Collector.Kemycals.bySymbol(this.symbol())},getOthers:function(){var others=Lab.Tools.Collector.Kemycals.bySymbol(this.symbol());for(var kemycal in others.Kemycals)others.Kemycals[kemycal]._labId==this._labId&&others.Kemycals.splice(kemycal,1);return others},sell:function(){return"undefined"!=typeof $?this.tube().sell():"Sorry, You Need Money."},proc:function(procedureId){if(this.hasOwnProperty("procedures")&&this.procedures.hasOwnProperty(procedureId))return this.procedures[procedureId].apply(this,arguments)}},KemycalMixture.prototype={each:function(proc){for(var kemycal in this.Kemycals)proc(this.Kemycals[kemycal])},get:function(offset){return this.Kemycals[offset]},size:function(){return Object.keys(this.Kemycals).length}};var Lab={Workspace:{Beakers:{},Tubes:{},Physical:{}}};return Lab.Tools={Labeler:function(){var dateObject=new Date;return(Math.random()*dateObject.getTime()).toString(36).substring(9)},Collector:{Tubes:{all:function(){return Lab.Workspace.Tubes=new TubeRack(document.querySelectorAll("["+KEMYSTRY_DATATAG_NAME+"]")),Lab.Workspace.Tubes},byKemycal:function(kemycalSymbol){var allTubes=Lab.Tools.Collector.Tubes.all(),tubesByKemycal=[];for(var tube in allTubes.Rack){if(allTubes.Rack.hasOwnProperty(tube))allTubes.Rack[tube].getMixture().Kemycals.hasOwnProperty(kemycalSymbol)&&tubesByKemycal.push(allTubes.Rack[tube])}return new TubeRack(tubesByKemycal)}},Kemycals:{all:function(){var allTubes=Lab.Tools.Collector.Tubes.all(),allKemycals=[];for(var tube in allTubes.Rack){if(allTubes.Rack.hasOwnProperty(tube))allTubes.Rack[tube].getMixture().each(function(kemycal){allKemycals.push(kemycal)}.bind(allKemycals))}return new KemycalMixture(allKemycals)},bySymbol:function(kemycalSymbol){var testTubesByKemycal=Lab.Tools.Collector.Tubes.byKemycal(kemycalSymbol),kemycalsBySymbol=[];for(var tube in testTubesByKemycal.Rack)if(testTubesByKemycal.Rack.hasOwnProperty(tube)){var mixture=testTubesByKemycal.Rack[tube].getMixture();mixture.Kemycals.hasOwnProperty(kemycalSymbol)&&kemycalsBySymbol.push(mixture.Kemycals[kemycalSymbol])}return new KemycalMixture(kemycalsBySymbol)}}},Styler:{setup:function(){var kemystryStyleTag=document.getElementById("kemystry-kemycals-physical-props");null===kemystryStyleTag&&(head=document.head||document.getElementsByTagName("head")[0]||document.body||document.getElementsByTagName("body")[0],(kemystryStyleTag=document.createElement("style")).id="kemystry-kemycals-physical-props",kemystryStyleTag.type="text/css",head.appendChild(kemystryStyleTag)),Lab.Tools.Styler.update()},add:function(symbol,state,style){Lab.Workspace.Physical[symbol]||(Lab.Workspace.Physical[symbol]={}),Lab.Workspace.Physical[symbol][state]=style},update:function(){var kemystryStyleTag=document.getElementById("kemystry-kemycals-physical-props");null!==kemystryStyleTag?kemystryStyleTag.innerHTML=Lab.Tools.Styler.get():Lab.Tools.Styler.setup()},get:function(){return Lab.Tools.Styler.make.css()},make:{attr:function(name,value){return name+": "+value+";\n"},attrs:function(object){for(var cssProp in cssAttrString="",object)object.hasOwnProperty(cssProp)&&(cssAttrString+="\t"+Lab.Tools.Styler.make.attr(cssProp,object[cssProp]));return cssAttrString},css:function(){var css="";for(var kemycalSymbol in Lab.Workspace.Physical)if(Lab.Workspace.Physical.hasOwnProperty(kemycalSymbol))for(var kemycalState in Lab.Workspace.Physical[kemycalSymbol])css+="base"==kemycalState?'[data-kemy*="'+kemycalSymbol+':"] {\n'+Lab.Tools.Styler.make.attrs(Lab.Workspace.Physical[kemycalSymbol][kemycalState])+"}\n":'[data-kemy*="'+kemycalSymbol+":"+kemycalState+'"] {\n'+Lab.Tools.Styler.make.attrs(Lab.Workspace.Physical[kemycalSymbol][kemycalState])+"}\n";return css}}},Deriver:{derive:function(kemycalFormula){return this.deriveFormula(kemycalFormula)},deriveFormula:function(formula){for(var derivedKemycal,derivedFormula=[],kemycalCollection=formula.split(" "),size=kemycalCollection.length,i=0;i<size;i++)derivedFormula[(derivedKemycal=this.deriveKemycal(kemycalCollection[i])).symbol]=derivedKemycal.state;return derivedFormula},deriveKemycal:function(kemycal){var kemycalBody,kemycalSymbol,kemycalState,derivedKemycal={};return kemycalSymbol=(kemycalBody=kemycal.split(":"))[0].trim().toLowerCase(),kemycalState=this.deriveState(kemycalBody[1].trim()),derivedKemycal.symbol=kemycalSymbol,derivedKemycal.state=kemycalState,derivedKemycal},deriveState:function(state){var derivedState=state.split(",");return derivedState instanceof Array&&1==derivedState.length&&(derivedState=derivedState[0]),derivedState},underive:function(kemycalDerivedFormula){return this.underiveFormula(kemycalDerivedFormula)},underiveFormula:function(kemycalDerivedFormula){return this.underiveKemycal(kemycalDerivedFormula).join(" ")},underiveKemycal:function(kemycalDerivedKemycal){var underivedKemycal=[];for(var kemycal in kemycalDerivedKemycal)kemycalDerivedKemycal.hasOwnProperty(kemycal)&&underivedKemycal.push(kemycal+":"+this.underiveState(kemycalDerivedKemycal[kemycal].state()));return underivedKemycal},underiveState:function(kemycalDerivedState){return kemycalDerivedState instanceof Array?underivedState=kemycalDerivedState.join(","):underivedState=kemycalDerivedState,underivedState}},Holder:function(){var args=arguments[0];return{contains:function(search){var checkThis=args[0];switch(typeof checkThis){case"object":if("[object Array]"==Object.prototype.toString.call(checkThis)){for(var i=checkThis.length;i--;)if(checkThis[i]===search)return!0;return!1}if(checkThis instanceof Tube){if("string"==typeof search)return!!checkThis.mixture.Kemycals.hasOwnProperty(search);if(search.hasOwnProperty("intensive"))return!!checkThis.mixture.Kemycals.hasOwnProperty(search.intensive.symbol)}return!!checkThis.hasOwnProperty(search);case"string":return-1!==checkThis.indexOf(search)}},getByDot:function(desc,value){for(var obj=args,arr=desc?desc.split("."):[];arr.length&&obj;){var comp=arr.shift(),match=new RegExp("(.+)\\[([0-9]*)\\]").exec(comp);if(null===match||3!=match.length)void 0!==value&&(void 0===obj[comp]&&(obj[comp]={}),0===arr.length&&(obj[comp]=value)),obj=obj[comp];else{var arrayData_arrName=match[1],arrayData_arrIndex=match[2];obj=void 0!==obj[arrayData_arrName]?(void 0!==value&&0===arr.length&&(obj[arrayData_arrName][arrayData_arrIndex]=value),obj[arrayData_arrName][arrayData_arrIndex]):void 0}}return obj}}}},Kemystry.Lab=Lab,Kemystry}(Kemystry||{});return Kemystry.open(),document.addEventListener("DOMContentLoaded",Kemystry.setup),"function"==typeof define&&define.amd&&define("kemystry",[],function(){return Kemystry}),void 0===noGlobal&&(window.Kemystry=Kemystry),Kemystry});
//# sourceMappingURL=kemystry.min.js.map